ul(class='nav nav-tabs pt-3')
    li(class='nav item')
        a(class='nav-link active') Chat Room


//- div(class='list group h-75' id="world_chat")
div(class='card overflow-auto' id="world_chat" style="height: 400px")
div(class='input-group border-top pt-2' )
    input(type='text' class='form-control' placeholder='Message world chat' id="message")
    div(class='input-group-append')
        if user
            button(class='btn btn-outline-primary' onClick='ButtonIsClicked()') Send
        else
            a(href='../login')
                button(class='btn btn-outline-primary') Send

script.
    var num_messages = 0

    function update_message(length){
        num_messages = length
    } 

    setInterval(function() {
        console.log(num_messages)
        $.ajax({method: 'GET',
        url: 'message', 
        data: {},
        dataType: "json", 
            success: function(rows){
            var length = rows.length
            if(num_messages < length) { 
                update_message(length)
                messages(rows)
                    } 
                }   

            });
    }, 1000)

    function ButtonIsClicked(){
        var chat_message = $("#message").val()
        $("#world_chat").html(null) 
        //- Check if message is empty or only space, then do nothing
        if(chat_message.trim().length != 0){           
                    $.ajax({method:'POST',
                        url: 'message', 
                        data: {message: chat_message}, 
                        success: function(fields){
                            //- console.log(fields);
                            $.ajax({method: 'GET',
                                url: 'message', 
                                data: {},
                                dataType: "json", 
                                success: function(rows){
                                    messages(rows)
                                }, 
                                error: function(err){alert("error when loading the data");}
                                });
                        }

                    });
        }

    }

    function messages(rows){
        $("#world_chat").html(null) 
        if(rows.length <= 6){
            for (i=0 ; i < rows.length ; i++){
                var messages_router =  $("#world_chat").html();
                var row = rows[i];
                $("#world_chat").html(messages_router + '<strong>' + row.uid + ': ' + '<small>' + '(' + row.timestamp + '): ' + row.message + '<hr>');
            }
        }
        else{                       
            for (i= (rows.length - 6) ; i < rows.length ; i++){
                var messages_content_one =  $("#world_chat").html();
                var row = rows[i];
                $("#world_chat").html(messages_content_one + '<strong>' + row.uid + ': ' + '<small>' + '(' + row.timestamp + '): ' + row.message + '<hr>');
            }
         }
    }  


